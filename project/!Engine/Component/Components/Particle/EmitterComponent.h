#pragma once

//-----------------------------------------------------------------------------------------
// include
//-----------------------------------------------------------------------------------------
//* component
#include "../BaseComponent.h"
#include "../Transform/TransformComponent.h"
#include "ParticleComponent.h"

//* engine
#include <Engine/System/Runtime/Performance/DeltaTimePoint.h>

////////////////////////////////////////////////////////////////////////////////////////////
// EmitterComponent class
////////////////////////////////////////////////////////////////////////////////////////////
class EmitterComponent final
	: public BaseComponent {
public:

	////////////////////////////////////////////////////////////////////////////////////////////
	// Emit structure
	////////////////////////////////////////////////////////////////////////////////////////////
	struct BaseEmitter {
	public:

		////////////////////////////////////////////////////////////////////////////////////////////
		// Output structure
		////////////////////////////////////////////////////////////////////////////////////////////
		struct Output {
		public:

			//=========================================================================================
			// public variables
			//=========================================================================================

			Vector3f position  = kOrigin3<float>;
			Vector3f direction = kOrigin3<float>;

		};

	public:

		//=========================================================================================
		// public methods
		//=========================================================================================

		virtual Output Emit() const = 0;

	};

	////////////////////////////////////////////////////////////////////////////////////////////
	// Sphere structure
	////////////////////////////////////////////////////////////////////////////////////////////
	struct Sphere
		: public BaseEmitter {
	public:

		//=========================================================================================
		// public methods
		//=========================================================================================

		Output Emit() const override;

		//=========================================================================================
		// public variables
		//=========================================================================================

		float radius = 0.1f;

	};



public:

	//=========================================================================================
	// public methods
	//=========================================================================================

	EmitterComponent(MonoBehaviour* behaviour);
	~EmitterComponent() override = default;

	//* emitter option *//

	void Update();

	void SetEmitCount(uint32_t count) { count_ = count; }

private:

	//=========================================================================================
	// private variables
	//=========================================================================================

	TimePointf<TimeUnit::second> time_       = { 0.1f };
	DeltaTimePointf<TimeUnit::second> timer_ = {};

	uint32_t count_ = 4;

	Sphere emitter_;

	//=========================================================================================
	// private methods
	//=========================================================================================

	const TransformComponent* RequireTransform() const;

	ParticleComponent* GetParticleComponent() const;

};
